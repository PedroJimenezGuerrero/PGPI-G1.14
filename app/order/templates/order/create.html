{% extends "shop/base/base.html" %}
{% load crispy_forms_tags %}
{% block title %}
Checkout
{% endblock %}
{% block content %}
<div class="container">
    <div class="order-info">
        <h1 class="text-center">Tu pedido</h1>
        <ul style="color:black">
            {% for item in cart %}
            <li>
                {{ item.quantity }}x {{ item.product.name }}
                <span>{{ item.total_price }} €</span>
            </li>
            {% endfor %}
            <li id="reembolso-item" style="display: none;">
                1x Coste de reserva
                <span>5.00 €</span>
            </li>
        </ul>
        <h4 style="color:black">Total: <span id="total-price">{{ cart.get_total_price|floatformat:2 }} €</span></h4>
    </div>
    <form action="." method="post" class="order-form">
        {{ form|crispy }}
        <div style="display:flex; justify-content: center;">
            <b style="color:red;">Recuerde que no se admiten devoluciones.</b>
        </div>
        <p><input class="btn btn-primary btn-sm btn-block" style="background-color: #0088FF;" type="submit" value="Finalizar"></p>
        {% csrf_token %}
    </form>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const paymentMethodField = document.querySelector('select[name="payment_method"]');
        const totalPriceElement = document.getElementById('total-price');
        const reembolsoItem = document.getElementById('reembolso-item');
        const baseTotalPrice = parseFloat({{ cart.get_total_price|floatformat:2 }});

        paymentMethodField.addEventListener('change', function() {
            let totalPrice = baseTotalPrice;
            if (paymentMethodField.value === 'contrareembolso') {
                totalPrice += 5;
                reembolsoItem.style.display = 'list-item';
            } else {
                reembolsoItem.style.display = 'none';
            }
            totalPriceElement.textContent = totalPrice.toFixed(2) + ' €';
        });
    });
</script>
{% endblock %}